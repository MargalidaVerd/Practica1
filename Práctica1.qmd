---
title: "Práctica 1"
author: "Carla Martínez, Patricia Mateu i Margalida Verd"
format: html
toc: true
editor: visual
len: spanish
---

Hola cucas, a ver en principio esta echo, lo que me he hecho un poco la picha un lio con el tema de los nombres de los data frames, os hago un resumen, y si se os ocurren nombre mejores (que es lo más probable, pq los mios resultan traumáticos) me decis y los cambio. Un besote xoxos.


!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
pinguinos ### data frame original
pinguinos_sin_filas_NA_por_todo ### data frame sin las dos filas que tinen NA por todo -----> i.e fila 4 y 272 ;) 
pinguinos_sin_NA ### data frame sin ningun NA -----> i.e le he aplicado la función na.omit()
¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡¡




Aquí dejamos la dirección de nuestro repositorio Github: https://github.com/MargalidaVerd/Practica1.git

Primero instalamos el paquete `palmerpenguins` y mostramos por pantalla las primeras filas para asegurarnos que se ha cargado correctamente:

```{r, warning=FALSE, echo = FALSE}
#install.packages("palmerpenguins")
library("palmerpenguins")
head(penguins,10)
pinguinos=penguins #le cambiamos el nombre al data frame
```

Veamos su estructura:

```{r, echo = FALSE}
str(pinguinos)
```

Observemos que la variable `year` es considerada un número pero no nos aporta información numérica sino que es más un factor a tener en cuenta como dato y no como número. Así pues, vamos a considerarla un factor:

```{r, echo=FALSE}
pinguinos$year = as.factor(pinguinos$year)
str(pinguinos)
```

Como podemos observar, el tamaño de la muestra realizada es de 344 pingüinos, de los que se han tomado datos de 8 variables diferentes. Entre estas encontramos tres variables de tipo *factor*: `species`, que puede tomar tres valores ("Adelie", "Chinstrap", "Gentoo"); la variable `island`, que asigna la isla de procedencia de cada individuo y toma tres valores también, que son "Biscoe", "Dream" y "Torgersen"; finalmente los niveles de la variable `sex` son "female" y "male", y `year`, que se atribuye al año de estudio de cada pingüino (2007, 2008 o 2009).

También encontramos dos variables del tipo *numérico*, que son `bill_length_mm`, que corresponde a la longitud del pico de cada pingüino, en milímetros, y `bill_depth_mm`, que corresponde al grosor del pico, también en milímetros.

Finalmente, tenemos tres últimas variables de tipo *integer*: `flipper_length_mm`, que corresponde a la longitud de las aletas de cada pingüino, en milímetros, y `body_mass_g`, que recoge la masa corporal en gramos de cada individuo.


Observamos también que hay valores NA, sin embargo, solo descartaremos a dichos sujetos en el caso en que esto nos afecte al estudio de los datos. Veamos pues, cuales son las muestras que contienen algun valor NA:

```{r, echo=FALSE}
filas_con_na <- which(apply(pinguinos, 1, function(row) any(is.na(row))))
```

```{r, echo=FALSE}
pinguinos[filas_con_na, ] 
```
Observamos que tenemos dos pinguinos de los que tan sólo sabemos la isla y el año en que se les fué tomada la muestra. Sin embargo, de el resto de pinguinos, los valores NA vienen asociados a la variable sexo. Por lo tanto, a la hora de descartar dichas muestras , lo haremos en función de la variable que estemos estudiando.

Así pues, trabajaremos con el data frame original siempre que no indiquemos lo contrario.

## Datos demográficos

Primero de todo, vamos a hacer un análisis de los datos básicos de la muestra, para familiarizarnos con ellos y poder estudiarlos con detalle más adelante. Empecemos por las especies de pingüinos. Recordemos que hay tres:

-   "Adelie"

-   "Chinstrap"

-   "Gentoo"

Veamos sus frecuencias relativas:

```{r, echo=FALSE}
table(pinguinos$species)
```

Con cierta diferencia, la especie más poblada es la *Adelie*, seguida de *Gentoo* y, finalmente, *Chinstrap*.

También es interesante estudiar la población por islas. A continuación lo vemos:

```{r, echo = FALSE}
table(pinguinos$island)
```

Como podemos ver, la isla más poblada es la de *Biscoe*, seguida de *Dream* y, por último, ya más alejada en cuanto a valores, la isla *Torgersen*.

Analicemos ahora la población de cada isla por especies; es decir, nos interesa ilustrar la cantidad de pingüinos de cada especie en cada isla. En el siguiente gráfico vemos como la especie *Adelie* se haya en las tres islas, mientras que las otras dos solo en una de ellas.

```{r, echo=FALSE, warning=FALSE}
library(ggplot2)
data2= pinguinos[, c(1,2)]
ggplot(data2, aes(island, fill = species)) +
  geom_bar() + guides(fill= guide_legend(title = ""))
```

Un dato también a tener en cuenta en nuestro AED es el año de estudio de los individuos. Visualicemos el recuento:

```{r, echo=FALSE}
table(pinguinos$year)
```

El tamaño de las muestras de cada año no fluctua significativamente.

Finalmente, veamos el sexo de los individuos de la muestra. Observamos, que ahora si que debemos tener en cuenta los valores NA, por lo tanto, ahora trabajaremos con el data frame que omite todas las filas que contienen algun valor NA.

```{r, echo=FALSE}
pinguinos_sin_NA= na.omit(pinguinos)
```


```{r, echo=FALSE}
table(str(pinguinos_sin_NA)$sex)
```

No notamos mucha diferencia entre machos y hembras, por lo que se podrá estudiar más adelante si existen diferencias en las características de los pingüinos en función del sexo cromosómico de estos.

## Estudio por especie

Vamos a analizar las diferentes característcas de cada especie. En primer lugar, estudiaremos la media de las caracerísticas de los pingüinos. Lo haremos con la función `aggregate()`, donde definiremos las características como vector y lo relacionaremos con las diferentes especies de nuestro dataframe. Observamos que ahora si que nos afectan las dos muestras que presentan valores NA en todas las variables, por lo tanto, trabajaremos con el data frame que omite a estos dos sujetos.

```{r, echo=FALSE}
pinguinos_sin_filas_NA_por_todo = pinguinos[-c(4,272), ]
```


```{r, echo=FALSE}
aggregate(cbind(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g )~species, 
          data=pinguinos_sin_filas_NA_por_todo, FUN=mean)
```

Como podemos observar, la especie *Chinstrap* es la que tiene el pico más largo y ancho en comparación a las medias de las otras dos especies. En cambio, la especie *Gentoo* tiene las aletas más largas que las otras dos especies que están bastante cerca en realción a la media. Y, por último, la especie *Gentoo* tiene el peso medio considerablemente más alto que las demás que son bastante próximas numéricamente.

Además nos interesa ver cuales son los valores máximos y minimos de cada una de las variables en función de su especie:

```{r, echo=FALSE}
aggregate(cbind(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g )~species, 
          data=pinguinos_sin_filas_NA_por_todo, FUN=max)
```

Observamos que los pinguinos que presentan los valores máximos de peso corporal, longitud del pico y del ala son todos de la especie *Gentoo*, notemos que en el caso de la masa corporal la diferencia es significativa en cuanto al resto de especies, mientras que en el grosor del pico el valor máximo viene dado por la especie *Chinstrap*. Notemos que el valor máximo del grosor del pico de la especie *Gentoo*, es menor que los valores máximos de las especies *Chinstrap* y *Adelie*.

Veamos que ocurre con los valores mínimos:

```{r, echo=FALSE}
aggregate(cbind(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g )~species, 
          data=pinguinos_sin_filas_NA_por_todo, FUN=min)
```

En este caso, los pinguinos *Adelie*, son los que presentan los valores mínimos tanto de la longitud del pico como la del ala; mientras que en cuanto al grosor del pico nos encontramos con un individuo de especie *Gentoo*, dato curioso, ya que hemos visto anteriormente que esta especie es la que presenta el valor máximo más pequeño de entre todas las especies. En cuanto al peso corporal, *Chinstrap* es la especie que presenta el valor mínimo.

Para finalizar este estudio por especies, resumiermos todo lo anterior en los siguientes gráficos:

```{r, echo=FALSE}
par(mfrow=c(2,2))
boxplot(pinguinos_sin_filas_NA_por_todo$bill_depth_mm ~ pinguinos_sin_filas_NA_por_todo$species, xlab = "Especie",  ylab = "Grosor del pico", )
boxplot(pinguinos_sin_filas_NA_por_todo$bill_length_mm ~ pinguinos_sin_filas_NA_por_todo$species, xlab = "Especie", ylab = "Longitud del pico")
boxplot(pinguinos_sin_filas_NA_por_todo$flipper_length_mm ~ pinguinos_sin_filas_NA_por_todo$species,xlab = "Especie", ylab = "Longitud del ala")
boxplot(pinguinos_sin_filas_NA_por_todo$body_mass_g ~ pinguinos_sin_filas_NA_por_todo$species, xlab = "Especie", ylab = "Masa corporal")
```

Ahora vamos a estudiar cada especie por separado. Empezaremos estudiando la especie *Adelie*, que es la más abundante. Vamos a mostrar la media de sus características en relación a la isla que habitan para ver si hay diferencias significativas entre habitar una isla u otra.

```{r, echo=FALSE}
adelie = pinguinos_sin_filas_NA_por_todo[which(pinguinos$species == "Adelie"),]
aggregate(cbind(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g )~island,
          data=adelie, FUN=mean)
```

Podemos observar que las medias de la largaria y anchura del pico son próximas numéricamente. En cambio, las aletas de los pingüinos *Adelie* de la isla *Torgersen* son un poco más largas que las de las otras islas. Sobre el peso podemos decir que las medias son bastante cercanas, así que no notamos diferencias significativas entre el peso de los pingüinos *Adelie* en referencia a habitar una isla u otra.

Notemos que con las especies *Chinstrap* y *Gentoo* no podemos hacer el estudio de las diferentes islas ya que sólo habitan una: la especie *Chinstrap* habita en *Dream* y la *Gentoo* en *Biscoe*.

## Estudio por sexo
De nuevo, usaremos el data frame que no contiene ningún valor NA, ya que éste afecta de forma directa al análisis en cuestión. 

En esta sección, analizaremos las posibles diferencias entre sexos. Veámoslo de forma sencilla: 

```{r, echo= FALSE}
aggregate(cbind(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g )~sex,
          data=pinguinos_sin_NA, FUN=mean)
```

Como se aprecia en la tabla anterior, hay algunas diferencias significativas entre sexos, donde el sexo masculino toma siempre los valores más altos. Cabe destacar la masa corporal: mientras que la media de las hembras ronda los 3900 gramos, la de los machos supera esta cifra en casi 700 gramos.

Fijémonos ahora en los máximos de cada variable:

```{r, echo=FALSE}
aggregate(cbind(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g )~sex,
          data=pinguinos_sin_NA, FUN= max)
```

La diferencia más significativa vuelve a ser la de la masa corporal, que difiere en casi 1000 gramos (1kg).

Lo mismo pasa con los valores mínimos, que los mostramos a continuación:

```{r, echo=FALSE}
aggregate(cbind(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g )~sex,
          data=pinguinos_sin_NA, FUN=min)
```

## Estudio por año de registro


Como hemos visto antes, cada año se tomaron datos de, aproximadamente 100 pingüinos. En esta sección analizamos con detalle si existen diferencias en función del año de estudio. Empecemos con las medias, como hemos hecho ya en las dos secciones anteriores:

```{r, echo = FALSE}
aggregate(cbind(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g )~year,
          data=pinguinos_sin_filas_NA_por_todo, FUN=mean)
```

La variación que más destaca es la media de la longitud de las aletas entre el 2007 y el 2008. Así mismo, en estos mismos años, la masa corporal de los pingüinos aumentó 110 gramos con respecto el año anterior.

## Conclusión

Vamos a ver de manera resumida los datos recogidos anteriormente:

```{r, echo=FALSE}
summary(pinguinos_sin_NA)
```

Notemos que el único cálculo que nos faltaría es la deviación típica de las variables numéricas. Para no tener que calcularlas una a una, utilizaremos la librería `psych` donde tenemos la funcion `describe()` que nos recoge los datos parecido a como lo haría un summary pero con otro parámetros que nos podrían interesar (la desviación típica entre otros). Por tanto, de la información que nos ofrece cogeremos aquellos que nos interesa investigar, en este caso, la media, la desviación típica, la mediana, el mínimo y el màximo de las variables `bill_length_mm`, `bill_depth_mm`,`flipper_length_mm`, `body_mass_g`.

```{r, echo=FALSE, warning=FALSE}
library(psych)
datos=pinguinos_sin_NA[, c(3,4,5,6)]
describe(datos)[, c(3,4,5,6,8,9,11)]
```

Observando los datos que nos da `summary()`, nos ofrece información ya calculada anteriormente para las variables `species`, `island`, `sex` y `year`. Vamos a analizar un poco más los datos recogidos en la tabla superior. Primero de todo, vamos a definir cada variable que hemos calculado: `mean` la media, `sd` la desviación típica, `median` la mediana, `trimmed` la media recortada, `min` el mínimo, `max` el máximo y `skew` el sesgo.

Si comparamos la media recortada (`trimmed`) con la media general (`mean`), podemos descubrir cuando los outliers estan sesgando la media con valores extremos. Como podemos ver las medias de las variables son muy próximas numéricamente a la media recortada cosa que nos indica que tenemos pocos o ningún outier en estas variables. Además, en comparación a sus respectivas medianas, también observamos que la distacia ente ellas es mínima.

Por otro lado, la variable `skew`(sesgo) nos ayuda a ver cuanto sesguegan la media los outliers que pudieran haber. Por tanto, notemos que todos los valores son menores a 1, cosa que nos hacer reafirmar la existencia de ningún o pocos outliers en las variables `bill_length_mm`, `bill_depth_mm`,`flipper_length_mm`, `body_mass_g`.
